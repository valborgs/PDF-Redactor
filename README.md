# PDF Masking Tool

PyQt6와 PyMuPDF를 기반으로 한 PDF 문서 마스킹(개인정보 가리기) 도구입니다.

## 📋 주요 기능

### 기본 기능
- 📂 **PDF 파일/폴더 열기**: 단일 파일 또는 폴더 내 모든 PDF 파일 불러오기
- 📄 **페이지 네비게이션**: 방향키, PageUp/Down으로 빠른 페이지 이동
- 🔍 **확대/축소**: Ctrl + 마우스휠로 50%~200% 범위 확대/축소
- 💾 **자동 저장 워크플로우**: 저장 후 다음 파일 자동 이동 제안

### 마스킹 기능
- 🖱️ **영역 선택**: Ctrl + 드래그로 마스킹 영역 지정
- 👁️ **실시간 미리보기**: 
  - 드래그 중: 파란색 반투명 표시
  - 저장된 마스킹: 빨간색 반투명 표시
- 📝 **메모 추가**: 마스킹 항목에 더블클릭으로 메모 편집
- 🗑️ **삭제**: Del 키로 선택한 마스킹 제거
- ⚪ **흰색 마스킹**: PDF 저장 시 마스킹 영역을 흰색으로 처리

### UI/UX
- 🎨 **전문적인 디자인**: Adobe Acrobat 스타일의 회색 배경
- 📐 **반응형 레이아웃**: 창 크기에 따라 자동 조정
- 🔧 **독립형 패널**: 마스킹 리스트와 파일 목록을 분리/재결합 가능
- 📊 **상태 표시**: 현재 페이지 번호와 확대율 실시간 표시

## 🚀 시작하기

### 필수 요구사항
- Python 3.12 이상
- uv (Python 패키지 관리자)

### 설치 방법

1. **저장소 클론**
```bash
git clone https://github.com/yourusername/pdfmask.git
cd pdfmask
```

2. **의존성 설치**
```bash
uv sync
```

3. **프로그램 실행**
```bash
uv run python main.py
```

## 📖 사용 방법

### 1. PDF 파일 열기

**방법 1: 단일 파일 열기**
- 메뉴: `파일 > PDF 열기...` 또는 툴바의 "PDF 열기" 버튼
- 단축키: 없음

**방법 2: 폴더 열기**
- 메뉴: `파일 > 폴더 열기...` 또는 툴바의 "폴더 열기" 버튼
- 단축키: `Ctrl+Shift+O`
- 폴더 내 모든 PDF 파일이 오른쪽 목록에 표시됩니다
- 파일 더블클릭으로 해당 PDF 열기

### 2. 페이지 탐색

| 키 | 동작 |
|---|---|
| `←` (Left) | 이전 페이지 |
| `→` (Right) | 다음 페이지 |
| `PageUp` | 이전 페이지 |
| `PageDown` | 다음 페이지 |

### 3. 확대/축소

- **확대/축소**: `Ctrl` + 마우스휠
- **범위**: 50% ~ 200%
- **중앙 정렬**: PDF가 항상 화면 중앙에 배치됨

### 4. 마스킹 작업

**마스킹 영역 선택**
1. `Ctrl` 키를 누른 상태에서 마우스로 드래그
2. 드래그 중 파란색 반투명 사각형 표시
3. 드래그 완료 시 빨간색으로 변경되며 왼쪽 목록에 추가

**메모 추가**
1. 왼쪽 마스킹 목록에서 원하는 항목의 "메모" 컬럼 더블클릭
2. 메모 입력 후 Enter 또는 다른 곳 클릭

**마스킹 삭제**
1. 왼쪽 마스킹 목록에서 항목 선택
2. `Del` 키 누르기
3. 화면에서도 빨간색 영역이 제거됨

### 5. 저장하기

**단축키**: `Ctrl+S`

**저장 프로세스**:
1. "마스킹 작업 내용을 저장하시겠습니까?" 확인
2. PyMuPDF로 마스킹 영역을 흰색으로 처리하여 PDF에 적용
3. "저장 완료" 메시지 표시
4. 다음 PDF 파일로 이동할지 확인 (폴더 열기로 작업 중인 경우)

**주의사항**:
- 저장 시 원본 PDF가 수정됩니다 (백업 권장)
- PDF가 다른 프로그램에서 열려있으면 저장 실패
- 저장 후 현재 PDF가 자동으로 제거되고 다음 파일로 이동

### 6. 패널 관리

**독립형 패널 사용**:
- 마스킹 목록 또는 PDF 파일 목록의 타이틀바를 더블클릭하여 분리
- 드래그하여 원하는 위치에 재결합 (상/하/좌/우)
- 여러 패널을 탭 형태로 결합 가능

**패널 표시/숨김**:
- 메뉴: `보기 > 마스킹 리스트` 또는 `보기 > PDF 파일 목록`

## ⌨️ 단축키 모음

| 단축키 | 기능 |
|--------|------|
| `Ctrl+Shift+O` | 폴더 열기 |
| `Ctrl+S` | 마스킹 저장 |
| `←` / `→` | 이전/다음 페이지 |
| `PageUp` / `PageDown` | 이전/다음 페이지 |
| `Ctrl` + 마우스휠 | 확대/축소 |
| `Ctrl` + 드래그 | 마스킹 영역 선택 |
| `Del` | 선택한 마스킹 삭제 |
| `더블클릭` | 메모 편집 |

## 🎨 UI 구성

```
┌─────────────────────────────────────────────────────────┐
│ 메뉴바: 파일 / 보기                                      │
├─────────────────────────────────────────────────────────┤
│ 툴바: [PDF 열기] [폴더 열기]                            │
├──────────────┬──────────────────────────┬───────────────┤
│              │                          │               │
│  마스킹 목록  │     PDF 뷰어 영역         │  PDF 파일     │
│              │   (가운데 정렬, 회색 배경)│   목록        │
│  - 페이지    │                          │               │
│  - 메모      │   ┌──────────────┐       │  - file1.pdf  │
│              │   │              │       │  - file2.pdf  │
│  [항목들]    │   │  PDF 내용    │       │  - file3.pdf  │
│              │   │  (흰색 배경)  │       │               │
│              │   │              │       │               │
│              │   └──────────────┘       │               │
│              │                          │               │
├──────────────┴──────────────────────────┴───────────────┤
│ 상태바: 페이지: 1 / 10 | 확대율: 100%                    │
└─────────────────────────────────────────────────────────┘
```

## 🛠️ 기술 스택

- **GUI Framework**: PyQt6 6.5.0+
- **PDF Processing**: PyMuPDF (fitz) 1.26.6+
- **Language**: Python 3.12+
- **Package Manager**: uv

## 📁 프로젝트 구조

```
pdfmask/
├── main.py              # 메인 애플리케이션 파일
├── pyproject.toml       # 프로젝트 의존성 설정
├── uv.lock             # 의존성 잠금 파일
├── DEVLOG.md           # 개발 과정 상세 기록
├── README.md           # 프로젝트 문서 (본 파일)
└── .gitignore          # Git 제외 파일 목록
```

## 🔧 주요 클래스 구조

### `PdfDocumentManager`
- PDF 문서 로드 및 관리
- 페이지 렌더링 (확대/축소 지원)
- PyMuPDF를 이용한 마스킹 적용 및 저장

### `PdfPageView`
- PDF 페이지 시각화
- 마우스 이벤트 처리 (드래그, 마스킹 선택)
- 좌표 변환 (화면 ↔ PDF)
- 마스킹 영역 시각적 표시

### `ScrollablePdfView`
- 스크롤 기능 제공
- 확대/축소 처리 (Ctrl+휠)
- 가운데 정렬 및 배경색 설정

### `MainWindow`
- 메인 윈도우 및 전체 UI 관리
- 메뉴, 툴바, 독 위젯 구성
- 마스킹 데이터 관리 (`MaskEntry`)
- 사용자 이벤트 처리 및 워크플로우 제어

### `MaskEntry` (dataclass)
```python
@dataclass
class MaskEntry:
    page_index: int      # 페이지 번호
    rect: fitz.Rect      # 마스킹 영역 (PDF 좌표)
    note: str = ""       # 사용자 메모
```

## ⚠️ 주의사항

1. **원본 파일 백업**: 저장 시 원본 PDF가 수정됩니다. 중요한 파일은 백업하세요.
2. **파일 잠금**: PDF를 다른 프로그램(Adobe Reader, 웹 브라우저 등)에서 열고 있으면 저장이 실패합니다.
3. **Incremental 저장**: PyMuPDF의 incremental 저장 방식을 사용하여 파일 크기가 약간 증가할 수 있습니다.
4. **마스킹 색상**: 마스킹 영역은 흰색(RGB: 1, 1, 1)으로 처리됩니다.

## 🐛 문제 해결

### "Permission denied" 오류
- **원인**: PDF가 다른 프로그램에서 열려있음
- **해결**: Adobe Reader, 웹 브라우저 등에서 해당 PDF를 닫고 재시도

### 독 위젯이 재결합되지 않음
- **해결**: 창을 최대화 해제한 후 재시도
- **참고**: 모든 방향(상/하/좌/우)으로 도킹 가능

### 확대/축소가 작동하지 않음
- **확인**: `Ctrl` 키를 누른 상태에서 마우스휠 스크롤
- **범위**: 50% ~ 200%

### 마스킹 드래그가 작동하지 않음
- **확인**: `Ctrl` 키를 누른 상태에서 드래그
- **참고**: 일반 드래그는 스크롤 기능

## 📝 개발 기록

프로젝트의 상세한 개발 과정과 구현 세부사항은 [DEVLOG.md](DEVLOG.md)를 참고하세요.

## 📄 라이선스

본 프로젝트는 자유롭게 사용 가능합니다.

## 🤝 기여

버그 리포트, 기능 제안, 풀 리퀘스트 환영합니다!

---

**PDF Masking Tool** - 간편하고 빠른 PDF 개인정보 마스킹 솔루션

